(function(i,r,g,d){"use strict";function b(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function l(t,n){for(var e=0;e<n.length;e++){var s=n[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function m(t,n,e){return n&&l(t.prototype,n),e&&l(t,e),t}function u(t){return t&&typeof t.length=="number"?t.length>0:t||t===0||t===!1}function h(t){return JSON.parse(JSON.stringify(t,function(n,e){if(e===t)return e;if(!(typeof n=="string"&&n.startsWith("_")))switch(typeof e){case"object":{if(Array.isArray(e)&&e.length===0)return;const s=Object.entries(e).filter(function(A){return u(A[1])});return s.length>0?Object.fromEntries(s):void 0}default:return u(e)?e:void 0}}))}var y=function(t){return t[t.PLAYING=0]="PLAYING",t[t.STREAMING=1]="STREAMING",t[t.LISTENING=2]="LISTENING",t[t.WATCHING=3]="WATCHING",t[t.COMPETING=5]="COMPETING",t}(y||{});const c=g.findByProps("getAssetIds"),f=Date.now(),a=r.plugin.storage;typeof a.selected?.length!="number"&&Object.assign(a,{selected:"default",selections:{default:I()}});function I(){return{name:"Discord",application_id:"1054951789318909972",flags:0,type:0,timestamps:{_enabled:!1,start:f},assets:{},buttons:[{},{}]}}async function o(t){if(typeof t!="object")throw new Error("Invalid activity");if(t){const n=t?.timestamps?._enabled;if(t=h(t),n?t.timestamps.start||=f:delete t.timestamps,t.assets){const e=[t.application_id,[t.assets.large_image,t.assets.small_image]];let s=c.getAssetIds(...e);s.length||(s=await c.fetchAssetIds(...e)),t.assets.large_image=s[0],t.assets.small_image=s[1]}t.buttons?.length?(t.buttons=t.buttons.filter(function(e){return e.label&&e.url}),t.buttons.length?Object.assign(t,{metadata:{button_urls:t.buttons.map(function(e){return e.url})},buttons:t.buttons.map(function(e){return e.label})}):delete t.buttons):delete t.buttons}return d.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:t,pid:1608,socketId:"RichPresence@Vendetta"}),t}var p=new(function(){function t(){b(this,t)}return m(t,[{key:"onLoad",value:function(){r.logger.log("Sending RPC request");const n=a.selections[a.selected];if(!n)throw new Error("Selected activity does not exist");o(n).then(function(e){r.logger.log("RPC request sent"),r.logger.log(e)}).catch(function(e){r.logger.error("An error occured while sending RPC request :("),r.logger.error(e?.stack??e)})}},{key:"onUnload",value:function(){r.logger.log("Stopping RPC request"),o(null)}}]),t}());return i.default=p,i.sendRequest=o,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta,vendetta.metro,vendetta.metro.common);
